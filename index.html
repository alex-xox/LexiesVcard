<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lexie ‚Äî My Favorite Person</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@400;600&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#fff0f6;
      --bg2:#ffe3ec;
      --ink:#2b2b2f;
      --muted:#6a5d6a;
      --rose:#ff4d8d;
      --rose2:#ff85a8;
      --paper:#fffafc;
      --paper2:#fff3f8;
      --shadow: 0 20px 60px rgba(35, 10, 25, .18);
      --shadow2: 0 10px 30px rgba(35, 10, 25, .14);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at 20% 20%, #ffffff 0%, transparent 55%),
        radial-gradient(900px 700px at 85% 25%, #ffffff 0%, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
    }

    /* subtle floating hearts in background */
    .bg-hearts{
      position:fixed; inset:0; pointer-events:none; overflow:hidden;
      filter: drop-shadow(0 8px 12px rgba(0,0,0,.06));
      opacity:.55;
    }
    .heart{
      position:absolute;
      width:16px; height:16px;
      transform: rotate(45deg);
      background: linear-gradient(135deg, rgba(255,77,141,.85), rgba(255,133,168,.75));
      border-radius: 4px;
      animation: floatUp linear infinite;
    }
    .heart::before,.heart::after{
      content:"";
      position:absolute; width:16px; height:16px;
      background: inherit;
      border-radius:50%;
    }
    .heart::before{ left:-8px; top:0;}
    .heart::after{ top:-8px; left:0;}
    @keyframes floatUp{
      from{ transform: translateY(20vh) rotate(45deg); opacity:0;}
      10%{opacity:.85}
      to{ transform: translateY(-120vh) rotate(45deg); opacity:0;}
    }

    /* Layout */
    .wrap{
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    .stage{
      width:min(980px, 96vw);
      height:min(660px, 86vh);
      position:relative;
      perspective: 1400px;
    }

    .hint{
      position:absolute;
      top:-40px; left:0; right:0;
      text-align:center;
      font-size:13px;
      color:rgba(60,25,45,.65);
      user-select:none;
    }
    .hint kbd{
      font: 600 12px/1 Inter, sans-serif;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.65);
      border:1px solid rgba(240, 170, 200, .65);
      box-shadow: 0 8px 16px rgba(0,0,0,.05);
    }

    /* Card Book */
    .book{
      width:100%;
      height:100%;
      position:relative;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      background:
        radial-gradient(120% 180% at 0% 0%, rgba(255,255,255,.85), rgba(255,255,255,.15)),
        linear-gradient(135deg, rgba(255,255,255,.65), rgba(255,255,255,.35));
      padding:18px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 133, 168, .35);
      touch-action: pan-y;
    }

    .book-inner{
      width:100%;
      height:100%;
      position:relative;
      border-radius: calc(var(--radius) - 8px);
      background: linear-gradient(135deg, rgba(255,255,255,.88), rgba(255,255,255,.76));
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(240, 170, 200, .25);
    }

    /* Navigation tap zones */
    .nav-zone{
      position:absolute; top:0; bottom:0;
      width:18%;
      z-index:80;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .nav-left{ left:0;}
    .nav-right{ right:0;}
    .nav-zone::after{
      content:"";
      position:absolute; inset:0;
      opacity:0;
      transition:opacity .2s ease;
    }
    .nav-left::after{ background: linear-gradient(90deg, rgba(255,77,141,.18), transparent); }
    .nav-right::after{ background: linear-gradient(270deg, rgba(255,77,141,.18), transparent); }
    .nav-zone:hover::after{opacity:1}

    /* Pages stack */
    .pages{
      position:absolute; inset:0;
      border-radius: calc(var(--radius) - 8px);
    }

    .page{
      position:absolute; inset:0;
      border-radius: calc(var(--radius) - 8px);
      background: linear-gradient(135deg, var(--paper), var(--paper2));
      transform-style: preserve-3d;
      transform-origin: left center;
      box-shadow: var(--shadow2);
      border: 1px solid rgba(240, 170, 200, .35);
      overflow:hidden;
      transition: transform 850ms cubic-bezier(.2,.9,.2,1);
    }

    /* Paper edge */
    .page::before{
      content:"";
      position:absolute; left:0; top:0; bottom:0;
      width:14px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.15)),
        linear-gradient(90deg, rgba(240,215,228,.9), rgba(240,215,228,.2));
      box-shadow: inset -1px 0 0 rgba(240,170,200,.25);
      opacity:.95;
      pointer-events:none;
    }

    .page.flipped{ transform: rotateY(-180deg); }

    /* Content + scrolling */
    .content{
      position:absolute;
      inset:0;
      padding: 40px 42px 28px 56px;
      display:flex;
      flex-direction:column;
      gap:16px;
      overflow:hidden;
    }
    .scrollable{
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding-right: 10px;
      flex:1;
    }

    .topline{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      color: var(--muted);
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .badge{
      padding:7px 10px;
      border-radius:999px;
      background: rgba(255,77,141,.10);
      border: 1px solid rgba(255,77,141,.22);
      box-shadow: 0 8px 16px rgba(0,0,0,.04);
      font-weight:700;
      color: rgba(120, 35, 70, .9);
    }

    h1,h2,h3{margin:0}
    .cover-name{
      font-family: "Great Vibes", cursive;
      font-size: clamp(52px, 7.3vw, 86px);
      line-height: 1;
      letter-spacing: .02em;
      color: rgba(90, 20, 55, .95);
      text-shadow:
        0 2px 0 rgba(255,255,255,.8),
        0 18px 40px rgba(255,77,141,.18);
    }
    .engraved{ position:relative; }
    .engraved::after{
      content:"";
      position:absolute;
      left:0; right:0;
      bottom:-10px;
      height:2px;
      background: linear-gradient(90deg, transparent, rgba(255,77,141,.55), transparent);
      filter: blur(.2px);
    }
    .subtitle{
      font-family: "Playfair Display", serif;
      font-weight:600;
      font-size: clamp(18px, 2.2vw, 26px);
      color: rgba(70, 30, 50, .88);
    }
    .note{
      color: rgba(60,25,45,.75);
      font-size: 14px;
      line-height: 1.45;
      max-width: 56ch;
    }
    .divider{
      height:1px;
      width:100%;
      background: linear-gradient(90deg, transparent, rgba(255,77,141,.30), transparent);
      margin: 8px 0;
    }

    /* Reasons */
    .reasons{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px 14px;
      margin-top:10px;
    }
    .reason{
      display:flex;
      gap:10px;
      padding:10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(240,170,200,.25);
      box-shadow: 0 10px 18px rgba(0,0,0,.04);
      align-items:flex-start;
      min-height: 44px;
    }
    .dot{
      width:22px; height:22px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255,77,141,.92), rgba(255,133,168,.65));
      display:grid;
      place-items:center;
      color:white;
      font-weight:900;
      font-size:12px;
      flex:0 0 auto;
      box-shadow: 0 10px 18px rgba(255,77,141,.20);
    }
    .reason span{
      font-size: 13px;
      line-height: 1.25;
      color: rgba(45, 20, 35, .88);
      font-weight:600;
    }

    /* Barely-visible secrets */
    .secrets{
      margin-top: 18px;
      padding-bottom: 8px;
      font-family: "Playfair Display", serif;
      font-size: 12.5px;
      line-height: 1.7;
      color: rgba(90, 20, 55, .18);
      user-select:none;
    }
    .secrets .line{
      filter: blur(.12px);
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
      letter-spacing: .01em;
    }

    /* Scratch */
    .scratch-wrap{
      display:grid;
      grid-template-columns: 1fr;
      gap:16px;
      align-items:stretch;
      margin-top:8px;
    }
    .panel{
      border-radius: 18px;
      background: rgba(255,255,255,.68);
      border: 1px solid rgba(240,170,200,.28);
      box-shadow: 0 12px 22px rgba(0,0,0,.05);
      padding:14px;
      position:relative;
      overflow:hidden;
      min-height: 340px;
    }
    .panel h3{
      font-family:"Playfair Display", serif;
      font-size:18px;
      color: rgba(70, 25, 50, .9);
      margin:0 0 6px;
    }
    .panel p{
      margin:0 0 12px;
      font-size: 13px;
      color: rgba(60,25,45,.72);
      line-height:1.35;
    }

    .scratch-area{
      position:relative;
      height: 230px;
      border-radius: 14px;
      overflow:hidden;
      border: 1px dashed rgba(255,77,141,.35);
      background: linear-gradient(135deg, rgba(255,77,141,.10), rgba(255,133,168,.08));
    }
    .scratch-under{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-family:"Great Vibes", cursive;
      font-size: 38px;
      color: rgba(90, 20, 55, .92);
      user-select:none;
      pointer-events:none;
      padding: 0 14px;
    }
    #scratchCanvas{
      position:absolute; inset:0;
      width:100%; height:100%;
      display:block;
      border-radius: 14px;
      touch-action:none;
    }

    /* Compliment Jar page */
    .jar-page{
      display:flex;
      flex-direction:column;
      gap:14px;
      flex:1;
    }
    .mini-panel{
      border-radius: 18px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(240,170,200,.25);
      box-shadow: 0 12px 22px rgba(0,0,0,.05);
      padding:16px;
      flex:1;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height: 380px;
    }
    .mini-panel h3{
      font-family:"Playfair Display", serif;
      font-size:20px;
      margin:0;
      color: rgba(70, 25, 50, .9);
      text-align:center;
    }
    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      margin-top: 6px;
    }
    .chip{
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,77,141,.10);
      border: 1px solid rgba(255,77,141,.22);
      font-weight:800;
      font-size:12px;
      color: rgba(90, 20, 55, .9);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, background .12s ease;
    }
    .chip:active{ transform: scale(.98); }
    .chip:hover{ background: rgba(255,77,141,.14); }
    .jar-note{
      margin-top:auto;
      padding:14px;
      border-radius: 14px;
      background: rgba(255,255,255,.88);
      border: 1px solid rgba(240,170,200,.28);
      color: rgba(50, 20, 35, .88);
      font-size:14px;
      line-height:1.4;
      min-height: 110px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
    }

    /* Constellation */
    .constellation{
      position:relative;
      border-radius: 18px;
      background:
        radial-gradient(800px 300px at 20% 20%, rgba(255,255,255,.9), rgba(255,255,255,.45)),
        linear-gradient(135deg, rgba(255,77,141,.08), rgba(255,133,168,.06));
      border: 1px solid rgba(255,77,141,.18);
      box-shadow: 0 16px 30px rgba(0,0,0,.06);
      overflow:hidden;
      height: 300px;
      padding-bottom: 78px;
    }
    .spark{
      position:absolute;
      width:14px; height:14px;
      transform: rotate(45deg);
      border-radius: 3px;
      background: linear-gradient(135deg, rgba(255,77,141,.92), rgba(255,133,168,.7));
      cursor:pointer;
      box-shadow: 0 12px 20px rgba(255,77,141,.22);
      transition: transform .12s ease;
      z-index:2;
    }
    .spark::before,.spark::after{
      content:"";
      position:absolute; width:14px; height:14px;
      background: inherit;
      border-radius:50%;
    }
    .spark::before{ left:-7px; top:0;}
    .spark::after{ top:-7px; left:0;}
    .spark:hover{ transform: rotate(45deg) scale(1.06); }

    .tooltip{
      position:absolute;
      left:16px; right:16px; bottom:14px;
      padding:10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.88);
      border: 1px solid rgba(240,170,200,.35);
      box-shadow: 0 18px 40px rgba(0,0,0,.08);
      font-size: 13px;
      color: rgba(50,20,35,.9);
      display:flex;
      gap:10px;
      align-items:flex-start;
      z-index:3;
    }
    .tooltip strong{font-weight:900}
    .tooltip .pill{
      margin-left:auto;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,77,141,.10);
      border: 1px solid rgba(255,77,141,.22);
      font-weight:900;
      font-size:12px;
      color: rgba(90, 20, 55, .92);
      white-space:nowrap;
    }

    /* FINAL PAGE (Valentine) */
    .valentine-cta{
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:14px;
      position:relative;
      overflow:hidden; /* keep fireworks clipped */
      padding: 6px 0 10px;
    }
    #fireworks{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:1;
    }
    .yes-btn{
      width:min(460px, 88%);
      height:92px;
      border:0;
      border-radius: 20px;
      font-weight: 1000;
      font-size: 30px;
      letter-spacing:.02em;
      color:white;
      cursor:pointer;
      background: linear-gradient(135deg, rgba(255,77,141,.98), rgba(255,133,168,.84));
      box-shadow: 0 22px 46px rgba(255,77,141,.28);
      transition: transform .12s ease, filter .12s ease;
      position:relative;
      z-index:3;
    }
    .yes-btn:hover{ filter: brightness(1.02); }
    .yes-btn:active{ transform: scale(.99); }

    .no-btn{
      width:130px;
      height:40px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.18);
      background: rgba(55,55,60,.92);
      color: rgba(255,255,255,.92);
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 12px 24px rgba(0,0,0,.12);
      z-index:2;
      position:absolute; /* we place it */
      left:50%;
      transform: translateX(-50%);
    }
    .no-btn::after{
      content:" :(";
      opacity:.85;
      font-weight:900;
    }

    .yes-msg{
      display:none;
      position:relative;
      z-index:3;
      max-width: 60ch;
      text-align:center;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.86);
      border: 1px solid rgba(240,170,200,.30);
      box-shadow: 0 14px 30px rgba(0,0,0,.06);
      color: rgba(50,20,35,.92);
      font-size: 14px;
      line-height: 1.35;
    }

    /* Mobile tweaks */
    @media (max-width: 820px){
      .content{ padding: 34px 18px 18px 44px; }
      .reasons{ grid-template-columns: 1fr; }
      .hint{ top:-46px; font-size:12px; }
      .nav-zone{ width:14%; }
      .constellation{ height: 260px; padding-bottom: 78px; }
      .yes-btn{ height:86px; font-size:28px; }
    }
  </style>
</head>

<body>
  <div class="bg-hearts" id="bgHearts" aria-hidden="true"></div>

  <div class="wrap">
    <div class="stage">
      <div class="hint">
        Swipe <kbd>‚Üê</kbd>/<kbd>‚Üí</kbd> on mobile ‚Ä¢ click edges on desktop ‚Ä¢ arrows work too
      </div>

      <div class="book" id="book">
        <div class="book-inner">
          <div class="nav-zone nav-left" id="navLeft" title="Previous page"></div>
          <div class="nav-zone nav-right" id="navRight" title="Next page"></div>

          <div class="pages" id="pages">

            <!-- PAGE 1: Cover -->
            <section class="page" data-index="0" style="z-index:6">
              <div class="content">
                <div class="topline">
                  <span class="badge">Valentine‚Äôs Card</span>
                  <span id="pageCountA">Page 1 / 6</span>
                </div>

                <div style="margin-top:10px">
                  <div class="cover-name engraved">Lexie</div>
                  <div class="subtitle" style="margin-top:14px">My Favorite Person</div>
                </div>

                <div class="divider"></div>

                <p class="note">A card for you üíó</p>

                <div style="margin-top:auto; display:flex; gap:12px; align-items:center; justify-content:space-between;">
                  <div class="note" style="margin:0; opacity:.85">
                    Tip: swipe left and right
                  </div>
                  <div class="badge" style="background:rgba(255,255,255,.65)">‚ô•</div>
                </div>
              </div>
            </section>

            <!-- PAGE 2: 15 reasons + subtle secrets -->
            <section class="page" data-index="1" style="z-index:5">
              <div class="content">
                <div class="topline">
                  <span class="badge">Chapter One</span>
                  <span>15 Reasons I Like You</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92)">
                  15 Reasons I Like You
                </h2>

                <div class="scrollable">
                  <p class="note" style="margin-top:0">
                    Just a few‚Ä¶ but you know I could keep going.
                  </p>

                  <div class="reasons" id="reasonsGrid"></div>

                  <div class="secrets" aria-hidden="true">
                    <div class="line">I love your confidence</div>
                    <div class="line">I love your smile up close</div>
                    <div class="line">I love the way you look at me</div>
                    <div class="line">I love how you drive me crazy</div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PAGE 3: Scratch (ONLY) -->
            <section class="page" data-index="2" style="z-index:4">
              <div class="content">
                <div class="topline">
                  <span class="badge">Interactive</span>
                  <span>Scratch to Reveal</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92)">
                  Little Surprise
                </h2>

                <div class="scrollable">
                  <p class="note" style="margin-top:0">
                    Scratch the panel to reveal the message.
                  </p>

                  <div class="scratch-wrap">
                    <div class="panel">
                      <h3>Scratch to Reveal</h3>
                      <p>Use your finger or mouse. Scratch enough and it shows through.</p>

                      <div class="scratch-area" id="scratchArea">
                        <div class="scratch-under">You make my days softer.</div>
                        <canvas id="scratchCanvas"></canvas>
                      </div>

                      <div style="height:10px"></div>
                      <p class="note" style="margin:0; font-size:13px; opacity:.9">
                        (No spoilers ‚Äî the cover stays fully opaque until you scratch.)
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PAGE 4: Compliment Jar -->
            <section class="page" data-index="3" style="z-index:3">
              <div class="content">
                <div class="topline">
                  <span class="badge">Interactive</span>
                  <span>Compliment Jar</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92); text-align:center">
                  Compliment Jar üíå
                </h2>

                <div class="jar-page">
                  <div class="mini-panel">
                    <h3>Pick a note</h3>
                    <p class="note" style="margin:0; text-align:center; max-width:none">
                      Tap a chip to pull a random message.
                    </p>
                    <div class="chips" id="chips"></div>
                    <div class="jar-note" id="jarNote">Pick one üíó</div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PAGE 5: Constellation -->
            <section class="page" data-index="4" style="z-index:2">
              <div class="content">
                <div class="topline">
                  <span class="badge">Interactive</span>
                  <span>Tap the Hearts</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92)">
                  A Little Constellation
                </h2>

                <p class="note" style="margin-top:-6px">
                  Tap the hearts to reveal tiny ‚Äúmoments‚Äù (you can edit these to match your story).
                </p>

                <div class="constellation" id="constellation">
                  <div class="tooltip" id="tooltip">
                    <strong>Tap a heart</strong> to reveal a note.
                    <span class="pill" id="foundPill">0 / 6 found</span>
                  </div>
                </div>

                <p class="note" style="margin-top:auto; opacity:.9">
                  (Replace these with inside jokes, dates, places, or memories.)
                </p>
              </div>
            </section>

            <!-- PAGE 6: FINAL VALENTINE PAGE -->
            <section class="page" data-index="5" style="z-index:1">
              <div class="content">
                <div class="topline">
                  <span class="badge">Final Page</span>
                  <span>One question</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:30px; color:rgba(70,25,50,.92); text-align:center">
                  Will you be my valentine?
                </h2>

                <div class="valentine-cta" id="valCta">
                  <canvas id="fireworks"></canvas>

                  <button class="yes-btn" id="yesBtn" type="button">yes üíñ</button>

                  <div class="yes-msg" id="yesMsg">
                    YAY!! üíó<br>
                    You just made my whole day. Come here ü•∫
                  </div>

                  <button class="no-btn" id="noBtn" type="button">no</button>
                </div>

                <p class="note" style="text-align:center; margin-top:auto; opacity:.9; max-width:none">
                  (If ‚Äúno‚Äù runs away‚Ä¶ it‚Äôs just shy.)
                </p>
              </div>
            </section>

          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    /* Background hearts */
    (function makeBgHearts(){
      const bg = document.getElementById('bgHearts');
      const count = 18;
      for(let i=0;i<count;i++){
        const h = document.createElement('div');
        h.className = 'heart';
        const left = Math.random()*100;
        const size = 10 + Math.random()*16;
        const dur = 8 + Math.random()*10;
        const delay = Math.random()*dur;
        h.style.left = left + 'vw';
        h.style.bottom = (-10 - Math.random()*30) + 'vh';
        h.style.width = size + 'px';
        h.style.height = size + 'px';
        h.style.animationDuration = dur + 's';
        h.style.animationDelay = (-delay) + 's';
        bg.appendChild(h);
      }
    })();

    /* Page flip logic + swipe */
    const pages = Array.from(document.querySelectorAll('.page'));
    let current = 0;

    function updatePageCounters(){
      const total = pages.length;
      const el = document.getElementById('pageCountA');
      if(el) el.textContent = `Page ${current+1} / ${total}`;
    }
    function goTo(idx){
      idx = Math.max(0, Math.min(pages.length-1, idx));
      current = idx;
      pages.forEach((p,i)=> (i < current) ? p.classList.add('flipped') : p.classList.remove('flipped'));
      pages.forEach((p,i)=> p.style.zIndex = (pages.length - i));
      updatePageCounters();
    }
    function next(){ goTo(current + 1); }
    function prev(){ goTo(current - 1); }

    document.getElementById('navRight').addEventListener('click', next);
    document.getElementById('navLeft').addEventListener('click', prev);

    window.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowRight') next();
      if(e.key === 'ArrowLeft') prev();
    });

    const book = document.getElementById('book');
    let touchStartX = 0, touchStartY = 0, tracking = false;

    book.addEventListener('touchstart', (e)=>{
      if(!e.touches || e.touches.length !== 1) return;
      const t = e.touches[0];
      touchStartX = t.clientX;
      touchStartY = t.clientY;
      tracking = true;
    }, {passive:true});

    book.addEventListener('touchmove', (e)=>{
      if(!tracking || !e.touches || e.touches.length !== 1) return;
      const t = e.touches[0];
      const dx = t.clientX - touchStartX;
      const dy = t.clientY - touchStartY;
      if(Math.abs(dx) > 18 && Math.abs(dx) > Math.abs(dy) + 10) e.preventDefault();
    }, {passive:false});

    book.addEventListener('touchend', (e)=>{
      if(!tracking) return;
      tracking = false;
      const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
      if(!t) return;
      const dx = t.clientX - touchStartX;
      const dy = t.clientY - touchStartY;
      if(Math.abs(dy) > Math.abs(dx)) return;
      if(dx < -60) next();
      else if(dx > 60) prev();
    }, {passive:true});

    goTo(0);

    /* Reasons list (random order) */
    const reasons = [
      "How easy you are to talk to",
      "Your laugh",
      "Your beautiful smile",
      "Your adorable little frown",
      "Your mesmerizing eyes",
      "The way you talk to me",
      "Your weirdness",
      "How happy you make me",
      "How sweet you are",
      "Your sense of humor",
      "Your kindness",
      "Your energy",
      "Your thoughtfulness",
      "How you make simple moments feel special",
      "The way you‚Äôre unapologetically you"
    ];
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }
    const reasonsGrid = document.getElementById('reasonsGrid');
    reasonsGrid.innerHTML = "";
    shuffle(reasons).forEach((text, idx)=>{
      const item = document.createElement('div');
      item.className = 'reason';
      item.innerHTML = `<div class="dot">${idx+1}</div><span>${text}</span>`;
      reasonsGrid.appendChild(item);
    });

    /* Scratch (fully opaque cover; no visible ‚Äúscratch here‚Äù text) */
    const scratchArea = document.getElementById('scratchArea');
    const canvas = document.getElementById('scratchCanvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    let isDrawing = false;

    function drawScratchCover(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);

      ctx.setTransform(1,0,0,1,0,0);
      ctx.clearRect(0,0,canvas.width,canvas.height);

      const grad = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
      grad.addColorStop(0, 'rgba(255,77,141,1)');
      grad.addColorStop(1, 'rgba(255,133,168,1)');
      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.globalAlpha = 0.16;
      for(let i=0;i<16;i++){
        const y = (i/16)*canvas.height;
        ctx.beginPath();
        ctx.moveTo(-canvas.width*0.2, y);
        ctx.lineTo(canvas.width*1.2, y + 50*dpr);
        ctx.lineWidth = 3.2 * dpr;
        ctx.strokeStyle = 'rgba(255,255,255,0.85)';
        ctx.stroke();
      }

      ctx.globalAlpha = 0.14;
      for(let i=0;i<900;i++){
        const x = Math.random()*canvas.width;
        const y = Math.random()*canvas.height;
        const r = (Math.random()*1.2 + 0.3) * dpr;
        ctx.beginPath();
        ctx.arc(x,y,r,0,Math.PI*2);
        ctx.fillStyle = (Math.random() > 0.5) ? 'rgba(255,255,255,.75)' : 'rgba(255,255,255,.35)';
        ctx.fill();
      }
      ctx.globalAlpha = 1;
    }

    function resizeScratch(){
      const rect = scratchArea.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);

      canvas.width  = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      canvas.style.width = rect.width + "px";
      canvas.style.height = rect.height + "px";

      drawScratchCover();
    }

    function scratchAt(clientX, clientY){
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const x = (clientX - rect.left) * dpr;
      const y = (clientY - rect.top) * dpr;

      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath();
      ctx.arc(x, y, 24 * dpr, 0, Math.PI*2);
      ctx.fill();
      ctx.globalCompositeOperation = 'source-over';
    }

    canvas.addEventListener('pointerdown', (e)=>{
      isDrawing = true;
      canvas.setPointerCapture?.(e.pointerId);
      scratchAt(e.clientX, e.clientY);
      e.preventDefault();
    });
    canvas.addEventListener('pointermove', (e)=>{
      if(!isDrawing) return;
      scratchAt(e.clientX, e.clientY);
      e.preventDefault();
    });
    const stopScratch = ()=>{ isDrawing = false; };
    canvas.addEventListener('pointerup', stopScratch);
    canvas.addEventListener('pointercancel', stopScratch);
    window.addEventListener('resize', ()=>requestAnimationFrame(resizeScratch));
    requestAnimationFrame(resizeScratch);

    /* Compliment Jar */
    const jarNotes = [
      "I like the way you make me feel calm and excited at the same time.",
      "You‚Äôre the kind of person I‚Äôd choose in every universe.",
      "Talking to you feels like a warm hoodie.",
      "You make ordinary days feel like something worth remembering.",
      "Your energy is the best kind of contagious.",
      "You‚Äôre effortlessly lovable. (Yes, that‚Äôs a thing.)"
    ];
    const chipLabels = ["Pick one", "Another", "Again", "More", "One more", "Surprise"];
    const chips = document.getElementById('chips');
    const jarNote = document.getElementById('jarNote');
    function randomFrom(a){ return a[Math.floor(Math.random()*a.length)] }
    chips.innerHTML = "";
    chipLabels.forEach((label)=>{
      const b = document.createElement('button');
      b.className = 'chip';
      b.type = 'button';
      b.textContent = label;
      b.addEventListener('click', ()=>{ jarNote.textContent = randomFrom(jarNotes); });
      chips.appendChild(b);
    });

    /* Constellation */
    const constellation = document.getElementById('constellation');
    const tooltip = document.getElementById('tooltip');
    const foundPill = document.getElementById('foundPill');

    const memoryNotes = [
      "A moment I realized I really like you.",
      "Something about your smile that stays in my head.",
      "The way you can make me laugh instantly.",
      "How you make things feel easier.",
      "A little thing you do that I adore.",
      "The ‚Äòthis is my favorite person‚Äô feeling."
    ];
    let found = 0;

    const heartsPos = [
      {x:14, y:14},{x:38, y:10},{x:62, y:14},
      {x:22, y:34},{x:52, y:30},{x:76, y:36}
    ];
    Array.from(constellation.querySelectorAll('.spark')).forEach(n=>n.remove());
    heartsPos.forEach((pos, i)=>{
      const s = document.createElement('div');
      s.className = 'spark';
      s.style.left = `calc(${pos.x}% - 8px)`;
      s.style.top  = `calc(${pos.y}% - 8px)`;
      s.dataset.opened = "0";
      s.addEventListener('click', ()=>{
        if(s.dataset.opened === "0"){
          s.dataset.opened = "1";
          found++;
          foundPill.textContent = `${found} / 6 found`;
        }
        tooltip.innerHTML = `<strong>Note:</strong> ${memoryNotes[i]}<span class="pill">${found} / 6 found</span>`;
      });
      constellation.appendChild(s);
    });

    /* FINAL PAGE: YES fireworks + message, NO teleports (never overlaps YES; always below) */
    const yesBtn = document.getElementById('yesBtn');
    const noBtn  = document.getElementById('noBtn');
    const yesMsg = document.getElementById('yesMsg');
    const fwCanvas = document.getElementById('fireworks');
    const fwCtx = fwCanvas.getContext('2d');

    let particles = [];
    let animating = false;

    function resizeFireworks(){
      const rect = fwCanvas.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      fwCanvas.width  = Math.floor(rect.width  * dpr);
      fwCanvas.height = Math.floor(rect.height * dpr);
    }

    function burst(x, y){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const count = 80;
      for(let i=0;i<count;i++){
        const a = Math.random()*Math.PI*2;
        const sp = (Math.random()*3.2 + 2.6) * dpr;
        particles.push({
          x, y,
          vx: Math.cos(a)*sp,
          vy: Math.sin(a)*sp,
          life: 70 + Math.random()*35,
          age: 0,
          size: (Math.random()*2.2 + 1.2) * dpr,
          hue: 320 + Math.random()*35
        });
      }
    }

    function animate(){
      if(!animating) return;
      fwCtx.clearRect(0,0,fwCanvas.width, fwCanvas.height);

      fwCtx.globalCompositeOperation = 'lighter';
      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.age++;
        p.vy += 0.06;   // gravity
        p.x += p.vx;
        p.y += p.vy;

        const t = 1 - (p.age / p.life);
        const alpha = Math.max(0, t);

        fwCtx.beginPath();
        fwCtx.arc(p.x, p.y, p.size, 0, Math.PI*2);
        fwCtx.fillStyle = `hsla(${p.hue}, 95%, 72%, ${alpha})`;
        fwCtx.fill();

        if(p.age >= p.life) particles.splice(i,1);
      }
      fwCtx.globalCompositeOperation = 'source-over';

      if(particles.length === 0){
        animating = false;
        fwCtx.clearRect(0,0,fwCanvas.width, fwCanvas.height);
        return;
      }
      requestAnimationFrame(animate);
    }

    function fireworksAroundYes(){
      resizeFireworks();
      const dpr = Math.max(1, window.devicePixelRatio || 1);

      const host = fwCanvas.getBoundingClientRect();
      const r = yesBtn.getBoundingClientRect();
      const cx = ((r.left + r.right)/2 - host.left) * dpr;
      const cy = ((r.top + r.bottom)/2 - host.top) * dpr;

      particles = [];
      animating = true;

      burst(cx, cy);
      burst(cx - fwCanvas.width*0.18, cy - fwCanvas.height*0.10);
      burst(cx + fwCanvas.width*0.18, cy - fwCanvas.height*0.10);

      requestAnimationFrame(animate);
    }

    yesBtn.addEventListener('click', ()=>{
      yesMsg.style.display = 'block';
      fireworksAroundYes();
      yesBtn.animate([{transform:'scale(1)'},{transform:'scale(1.02)'},{transform:'scale(1)'}], {duration:240, easing:'ease-out'});
    });

    function placeNoSafely(randomize){
      const cta = document.getElementById('valCta');
      const ctaRect = cta.getBoundingClientRect();
      const yesRect = yesBtn.getBoundingClientRect();

      const btnW = noBtn.offsetWidth || 130;
      const btnH = noBtn.offsetHeight || 40;

      // no-go zone (YES + margin), in CTA coordinates
      const noGo = {
        left: (yesRect.left - ctaRect.left) - 18,
        right: (yesRect.right - ctaRect.left) + 18,
        top: (yesRect.top - ctaRect.top) - 18,
        bottom: (yesRect.bottom - ctaRect.top) + 18
      };

      const padL = 22, padR = 22, padB = 16;
      const minX = padL;
      const maxX = ctaRect.width - padR - btnW;

      // ALWAYS below YES (also keeps it away from message area somewhat)
      const minY = Math.max(noGo.bottom + 24, ctaRect.height * 0.66);
      const maxY = ctaRect.height - padB - btnH;
      const safeMinY = Math.min(minY, maxY);

      // default: centered under YES
      let x = (ctaRect.width/2) - (btnW/2);
      let y = Math.max(safeMinY, ctaRect.height * 0.78);

      if(randomize){
        for(let tries=0; tries<50; tries++){
          x = minX + Math.random() * Math.max(8, (maxX - minX));
          y = safeMinY + Math.random() * Math.max(8, (maxY - safeMinY));

          const intersects =
            x < noGo.right &&
            x + btnW > noGo.left &&
            y < noGo.bottom &&
            y + btnH > noGo.top;

          if(!intersects) break;
        }
      }

      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";
      noBtn.style.transform = "translateX(0)";
    }

    // Start centered under YES
    placeNoSafely(false);

    noBtn.addEventListener('click', (e)=>{
      e.preventDefault();
      placeNoSafely(true);
      noBtn.animate(
        [{transform:'translateX(0) scale(1)'},{transform:'translateX(0) scale(1.06)'},{transform:'translateX(0) scale(1)'}],
        {duration:240, easing:'ease-out'}
      );
    });

    window.addEventListener('resize', ()=>{
      resizeFireworks();
      placeNoSafely(false);
      requestAnimationFrame(resizeScratch);
    });
  </script>
</body>
</html>
