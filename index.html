<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lexie ‚Äî My Favorite Person</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@400;600&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#fff0f6;
      --bg2:#ffe3ec;
      --ink:#2b2b2f;
      --muted:#6a5d6a;
      --rose:#ff4d8d;
      --rose2:#ff85a8;
      --paper:#fffafc;
      --paper2:#fff3f8;
      --shadow: 0 20px 60px rgba(35, 10, 25, .18);
      --shadow2: 0 10px 30px rgba(35, 10, 25, .14);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at 20% 20%, #ffffff 0%, transparent 55%),
        radial-gradient(900px 700px at 85% 25%, #ffffff 0%, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
    }

    /* subtle floating hearts in background */
    .bg-hearts{
      position:fixed; inset:0; pointer-events:none; overflow:hidden;
      filter: drop-shadow(0 8px 12px rgba(0,0,0,.06));
      opacity:.55;
    }
    .heart{
      position:absolute;
      width:16px; height:16px;
      transform: rotate(45deg);
      background: linear-gradient(135deg, rgba(255,77,141,.85), rgba(255,133,168,.75));
      border-radius: 4px;
      animation: floatUp linear infinite;
    }
    .heart::before,.heart::after{
      content:"";
      position:absolute; width:16px; height:16px;
      background: inherit;
      border-radius:50%;
    }
    .heart::before{ left:-8px; top:0;}
    .heart::after{ top:-8px; left:0;}
    @keyframes floatUp{
      from{ transform: translateY(20vh) rotate(45deg); opacity:0;}
      10%{opacity:.85}
      to{ transform: translateY(-120vh) rotate(45deg); opacity:0;}
    }

    /* Layout */
    .wrap{
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .stage{
      width:min(980px, 96vw);
      height:min(660px, 86vh);
      position:relative;
      perspective: 1400px;
    }

    .hint{
      position:absolute;
      top:-40px; left:0; right:0;
      text-align:center;
      font-size:13px;
      color:rgba(60,25,45,.65);
      user-select:none;
    }
    .hint kbd{
      font: 600 12px/1 Inter, sans-serif;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.65);
      border:1px solid rgba(240, 170, 200, .65);
      box-shadow: 0 8px 16px rgba(0,0,0,.05);
    }

    /* Card Book */
    .book{
      width:100%;
      height:100%;
      position:relative;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      background:
        radial-gradient(120% 180% at 0% 0%, rgba(255,255,255,.85), rgba(255,255,255,.15)),
        linear-gradient(135deg, rgba(255,255,255,.65), rgba(255,255,255,.35));
      padding:18px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 133, 168, .35);
      touch-action: pan-y; /* vertical scroll allowed; horizontal swipe handled by JS */
    }
    .book-inner{
      width:100%;
      height:100%;
      position:relative;
      border-radius: calc(var(--radius) - 8px);
      background: linear-gradient(135deg, rgba(255,255,255,.88), rgba(255,255,255,.76));
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(240, 170, 200, .25);
    }

    /* Navigation tap zones (desktop) */
    .nav-zone{
      position:absolute; top:0; bottom:0;
      width:18%;
      z-index:80;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .nav-left{ left:0;}
    .nav-right{ right:0;}
    .nav-zone::after{
      content:"";
      position:absolute; inset:0;
      opacity:0;
      transition:opacity .2s ease;
    }
    .nav-left::after{ background: linear-gradient(90deg, rgba(255,77,141,.18), transparent); }
    .nav-right::after{ background: linear-gradient(270deg, rgba(255,77,141,.18), transparent); }
    .nav-zone:hover::after{opacity:1}

    /* Pages stack */
    .pages{
      position:absolute; inset:0;
      border-radius: calc(var(--radius) - 8px);
    }
    .page{
      position:absolute; inset:0;
      border-radius: calc(var(--radius) - 8px);
      background: linear-gradient(135deg, var(--paper), var(--paper2));
      transform-style: preserve-3d;
      transform-origin: left center;
      box-shadow: var(--shadow2);
      border: 1px solid rgba(240, 170, 200, .35);
      overflow:hidden;
      transition: transform 850ms cubic-bezier(.2,.9,.2,1);
    }
    /* Paper edge */
    .page::before{
      content:"";
      position:absolute; left:0; top:0; bottom:0;
      width:14px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.15)),
        linear-gradient(90deg, rgba(240,215,228,.9), rgba(240,215,228,.2));
      box-shadow: inset -1px 0 0 rgba(240,170,200,.25);
      opacity:.95;
      pointer-events:none;
    }
    .page.flipped{ transform: rotateY(-180deg); }

    /* Content + scrolling */
    .content{
      position:absolute;
      inset:0;
      padding: 40px 42px 28px 56px;
      display:flex;
      flex-direction:column;
      gap:16px;
      overflow:hidden;
    }
    .scrollable{
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding-right: 10px;
      flex:1;
      touch-action: pan-y;
    }

    .topline{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      color: var(--muted);
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .badge{
      padding:7px 10px;
      border-radius:999px;
      background: rgba(255,77,141,.10);
      border: 1px solid rgba(255,77,141,.22);
      box-shadow: 0 8px 16px rgba(0,0,0,.04);
      font-weight:700;
      color: rgba(120, 35, 70, .9);
    }

    h1,h2,h3{margin:0}
    .cover-name{
      font-family: "Great Vibes", cursive;
      font-size: clamp(56px, 7.6vw, 92px);
      line-height: 1;
      letter-spacing: .02em;
      color: rgba(90, 20, 55, .95);
      text-shadow:
        0 2px 0 rgba(255,255,255,.85),
        0 18px 44px rgba(255,77,141,.20);
    }
    .engraved{ position:relative; }
    .engraved::after{
      content:"";
      position:absolute;
      left:0; right:0;
      bottom:-10px;
      height:2px;
      background: linear-gradient(90deg, transparent, rgba(255,77,141,.55), transparent);
      filter: blur(.2px);
    }
    .subtitle{
      font-family: "Playfair Display", serif;
      font-weight:600;
      font-size: clamp(18px, 2.2vw, 26px);
      color: rgba(70, 30, 50, .88);
    }
    .note{
      color: rgba(60,25,45,.75);
      font-size: 14px;
      line-height: 1.45;
      max-width: 56ch;
    }
    .divider{
      height:1px;
      width:100%;
      background: linear-gradient(90deg, transparent, rgba(255,77,141,.30), transparent);
      margin: 8px 0;
    }

    /* Cover decorations */
    .cover-frame{
      position:relative;
      flex:1;
      border-radius: 18px;
      background:
        radial-gradient(900px 420px at 20% 15%, rgba(255,255,255,.9), rgba(255,255,255,.55)),
        linear-gradient(135deg, rgba(255,77,141,.07), rgba(255,133,168,.06));
      border: 1px solid rgba(240,170,200,.30);
      box-shadow: 0 18px 34px rgba(0,0,0,.06);
      padding: 22px 20px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      gap:12px;
    }
    .cover-frame::before,
    .cover-frame::after{
      content:"";
      position:absolute;
      width:220px; height:220px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,77,141,.18), rgba(255,133,168,0));
      opacity:.9;
      pointer-events:none;
    }
    .cover-frame::before{ left:-70px; top:-70px; }
    .cover-frame::after{ right:-80px; bottom:-80px; }

    .flourish{
      position:absolute;
      width:170px;
      height:170px;
      opacity:.55;
      pointer-events:none;
      filter: drop-shadow(0 10px 20px rgba(255,77,141,.10));
    }
    .flourish.tl{ left:10px; top:10px; transform: rotate(-6deg); }
    .flourish.br{ right:10px; bottom:10px; transform: rotate(174deg); opacity:.45; }

    .seal{
      margin-top: 2px;
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(240,170,200,.32);
      box-shadow: 0 12px 22px rgba(0,0,0,.05);
      color: rgba(70, 25, 50, .86);
      font-weight: 800;
      font-size: 12px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .seal .mini-heart{
      width:16px; height:16px;
      transform: rotate(45deg);
      background: linear-gradient(135deg, rgba(255,77,141,.92), rgba(255,133,168,.72));
      border-radius: 4px;
      position:relative;
      box-shadow: 0 10px 18px rgba(255,77,141,.18);
    }
    .seal .mini-heart::before,
    .seal .mini-heart::after{
      content:"";
      position:absolute; width:16px; height:16px;
      background: inherit;
      border-radius:50%;
    }
    .seal .mini-heart::before{ left:-8px; top:0; }
    .seal .mini-heart::after{ top:-8px; left:0; }

    .cover-tagline{
      font-family: "Playfair Display", serif;
      font-size: 15px;
      color: rgba(60,25,45,.76);
      max-width: 52ch;
      line-height: 1.55;
    }

    /* Reasons */
    .reasons{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px 14px;
      margin-top:10px;
    }
    .reason{
      display:flex;
      gap:10px;
      padding:10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(240,170,200,.25);
      box-shadow: 0 10px 18px rgba(0,0,0,.04);
      align-items:flex-start;
      min-height: 44px;
    }
    .dot{
      width:22px; height:22px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255,77,141,.92), rgba(255,133,168,.65));
      display:grid;
      place-items:center;
      color:white;
      font-weight:900;
      font-size:12px;
      flex:0 0 auto;
      box-shadow: 0 10px 18px rgba(255,77,141,.20);
    }
    .reason span{
      font-size: 13px;
      line-height: 1.25;
      color: rgba(45, 20, 35, .88);
      font-weight:600;
    }

    /* Barely-visible secrets */
    .secrets{
      display: none;
    }
    .secrets{
      margin-top: 18px;
      padding-bottom: 8px;
      font-family: "Playfair Display", serif;
      font-size: 12.5px;
      line-height: 1.7;
      color: rgba(90, 20, 55, .08);
      user-select:none;
    }
    .secrets .line{
      filter: blur(.35px);
      text-shadow: 0 1px 0 rgba(255,255,255,.6);
      letter-spacing: .01em;
    }

    /* Scratch */
    .scratch-wrap{
      display:grid;
      grid-template-columns: 1fr;
      gap:16px;
      align-items:stretch;
      margin-top:8px;
    }
    .panel{
      border-radius: 18px;
      background: rgba(255,255,255,.68);
      border: 1px solid rgba(240,170,200,.28);
      box-shadow: 0 12px 22px rgba(0,0,0,.05);
      padding:14px;
      position:relative;
      overflow:hidden;
      min-height: 340px;
    }
    .panel h3{
      font-family:"Playfair Display", serif;
      font-size:18px;
      color: rgba(70, 25, 50, .9);
      margin:0 0 6px;
    }
    .panel p{
      margin:0 0 12px;
      font-size: 13px;
      color: rgba(60,25,45,.72);
      line-height:1.35;
    }
    .scratch-area{
      position:relative;
      height: 230px;
      border-radius: 14px;
      overflow:hidden;
      border: 1px dashed rgba(255,77,141,.35);
      background: linear-gradient(135deg, rgba(255,77,141,.10), rgba(255,133,168,.08));
    }
    .scratch-under{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-family:"Great Vibes", cursive;
      font-size: 38px;
      color: rgba(90, 20, 55, .92);
      user-select:none;
      pointer-events:none;
      padding: 0 14px;
    }
    #scratchCanvas{
      position:absolute; inset:0;
      width:100%; height:100%;
      display:block;
      border-radius: 14px;
      touch-action:none;
    }

    /* Compliment Jar */
    .jar-page{ display:flex; flex-direction:column; gap:14px; flex:1; }
    .mini-panel{
      border-radius: 18px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(240,170,200,.25);
      box-shadow: 0 12px 22px rgba(0,0,0,.05);
      padding:18px;
      flex:1;
      display:flex;
      flex-direction:column;
      gap:14px;
      min-height: 380px;
    }
    .mini-panel h3{
      font-family:"Playfair Display", serif;
      font-size:20px;
      margin:0;
      color: rgba(70, 25, 50, .9);
      text-align:center;
    }
    .jar-btn{
      align-self:center;
      margin-top: 8px;
      width:min(360px, 86%);
      height:54px;
      border:0;
      border-radius: 16px;
      cursor:pointer;
      font-weight: 1000;
      font-size: 16px;
      color:white;
      background: linear-gradient(135deg, rgba(255,77,141,.96), rgba(255,133,168,.84));
      box-shadow: 0 18px 34px rgba(255,77,141,.20);
      transition: transform .12s ease, filter .12s ease;
    }
    .jar-btn:hover{ filter: brightness(1.02); }
    .jar-btn:active{ transform: scale(.99); }
    .jar-note{
      margin-top:auto;
      padding:16px 14px;
      border-radius: 14px;
      background: rgba(255,255,255,.88);
      border: 1px solid rgba(240,170,200,.28);
      color: rgba(50, 20, 35, .88);
      font-size:14px;
      line-height:1.45;
      min-height: 130px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
    }

    /* Choose the Vibe (stacked choices) */
    .vibe-wrap{ flex:1; display:flex; flex-direction:column; gap:12px; min-height:0; }
    .vibe-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-top: 8px;
    }
    .vibe-card{
      border-radius: 16px;
      background: rgba(255,255,255,.68);
      border: 1px solid rgba(240,170,200,.26);
      box-shadow: 0 12px 22px rgba(0,0,0,.05);
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height: 120px;
      position:relative;
      overflow:hidden;
      touch-action: manipulation;
    }
    .vibe-card::after{
      content:"";
      position:absolute;
      inset:0;
      opacity:.0;
      background: radial-gradient(600px 160px at 10% 0%, rgba(255,77,141,.14), transparent 55%);
      transition: opacity .2s ease;
      pointer-events:none;
    }
    .vibe-card:hover::after{ opacity:.9; }

    .vibe-stack{
      display:flex;
      flex-direction:column;
      gap:10px;
      position:relative;
      z-index:1;
      align-items:flex-start;
    }

    .vibe-option{
      width:100%;
      border: 1px solid rgba(255,77,141,.22);
      background: rgba(255,77,141,.10);
      color: rgba(90, 20, 55, .92);
      box-shadow: 0 10px 18px rgba(0,0,0,.04);
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 13px;
      cursor:pointer;
      transition: transform .10s ease, filter .12s ease, background .12s ease, border-color .12s ease, opacity .12s ease;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      text-align:center;
      white-space:nowrap;
    }
    .vibe-option:active{ transform: scale(.99); }
    .vibe-option.picked{
      background: rgba(255,77,141,.22);
      border-color: rgba(255,77,141,.36);
      filter: brightness(1.03);
    }
    .vibe-option.dim{
      opacity:.55;
      filter: saturate(.85);
    }

    /* Constellation */
    .constellation{
      position:relative;
      border-radius: 18px;
      background:
        radial-gradient(800px 300px at 20% 20%, rgba(255,255,255,.9), rgba(255,255,255,.45)),
        linear-gradient(135deg, rgba(255,77,141,.08), rgba(255,133,168,.06));
      border: 1px solid rgba(255,77,141,.18);
      box-shadow: 0 16px 30px rgba(0,0,0,.06);
      overflow:hidden;
      height: 300px;
      padding-bottom: 128px; /* reserve space for tooltip + counter */
    }
    .spark{
      position:absolute;
      width:14px; height:14px;
      transform: rotate(45deg);
      border-radius: 3px;
      background: linear-gradient(135deg, rgba(255,77,141,.92), rgba(255,133,168,.7));
      cursor:pointer;
      box-shadow: 0 12px 20px rgba(255,77,141,.22);
      transition: transform .12s ease;
      z-index:2;
    }
    .spark::before,.spark::after{
      content:"";
      position:absolute; width:14px; height:14px;
      background: inherit;
      border-radius:50%;
    }
    .spark::before{ left:-7px; top:0;}
    .spark::after{ top:-7px; left:0;}
    .spark:hover{ transform: rotate(45deg) scale(1.06); }

    /* Tooltip (fixed size) */
    .tooltip{
  position:absolute;
  left:16px;
  right:16px;
  bottom:14px;

  min-height: 110px;
  padding:14px 16px;

  border-radius:14px;
  background: rgba(255,255,255,.88);
  border: 1px solid rgba(240,170,200,.35);
  box-shadow: 0 18px 40px rgba(0,0,0,.08);

  font-size: 13px;
  color: rgba(50,20,35,.9);

  display:flex;
  flex-direction: column;      /* üëà stack vertically */
  align-items: center;         /* üëà center horizontally */
  justify-content: flex-start;
  gap:8px;

  text-align: center;
  z-index:3;
}

/* Header text */
.tooltip strong{
  font-weight:900;
  white-space: nowrap;
}

/* Message text */
.tooltip .tip-text{
  max-width: 100%;
  line-height:1.4;
}
    .tooltip strong{
  font-weight:900;
  white-space: nowrap;
  flex: 0 0 auto;
}

.tooltip .tip-text{
  min-width: 0;
}

    /* Counter pinned BELOW tooltip */
    .found-counter{
      position:absolute;
      left:16px;
      right:16px;
      bottom:14px;
      display:flex;
      justify-content:center;
      pointer-events:none;
      z-index:3;
    }
    .pill{
      padding:6px 12px;
      border-radius:999px;
      background: rgba(255,77,141,.10);
      border: 1px solid rgba(255,77,141,.22);
      font-weight:900;
      font-size:12px;
      color: rgba(90, 20, 55, .92);
      white-space:nowrap;
    }

    /* Final page */
    .valentine-cta{
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:14px;
      position:relative;
      overflow:hidden;
      padding: 6px 0 10px;
    }
    #fireworks{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:1;
    }
    .yes-btn{
      width:min(460px, 88%);
      height:92px;
      border:0;
      border-radius: 20px;
      font-weight: 1000;
      font-size: 30px;
      letter-spacing:.02em;
      color:white;
      cursor:pointer;
      background: linear-gradient(135deg, rgba(255,77,141,.98), rgba(255,133,168,.84));
      box-shadow: 0 22px 46px rgba(255,77,141,.28);
      transition: transform .12s ease, filter .12s ease;
      position:relative;
      z-index:3;
    }
    .yes-btn:hover{ filter: brightness(1.02); }
    .yes-btn:active{ transform: scale(.99); }

    .no-btn{
      width:130px;
      height:40px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.18);
      background: rgba(55,55,60,.92);
      color: rgba(255,255,255,.92);
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 12px 24px rgba(0,0,0,.12);
      z-index:2;
      position:absolute;
      left:50%;
      transform: translateX(-50%);
    }
    .no-btn::after{ content:" :("; opacity:.85; font-weight:900; }

    .yes-msg{
      display:none;
      position:relative;
      z-index:3;
      max-width: 60ch;
      text-align:center;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.86);
      border: 1px solid rgba(240,170,200,.30);
      box-shadow: 0 14px 30px rgba(0,0,0,.06);
      color: rgba(50,20,35,.92);
      font-size: 14px;
      line-height: 1.35;
    }

    /* Mobile tweaks */
    @media (max-width: 820px){
      .content{ padding: 34px 18px 18px 44px; }
      .reasons{ grid-template-columns: 1fr; }
      .hint{ top:-46px; font-size:12px; }
      .nav-zone{ width:14%; }
      .constellation{ height: 260px; padding-bottom: 126px; }
      .tooltip{ min-height: 96px; bottom:56px; }
      .yes-btn{ height:86px; font-size:28px; }
      .cover-frame{ padding: 18px 14px; }
      .flourish{ width:140px; height:140px; }
      .jar-btn{ height:52px; font-size:15px; }
      .vibe-grid{ grid-template-columns: 1fr; }
      .vibe-card{ min-height: 112px; }
    }

   /* ============================
   HOLD THE HEART PAGE
   ============================ */
.holdheart-page{
  padding: clamp(22px, 4vh, 48px);
}

.hh-wrap{
  max-width: 520px;
  margin: 0 auto;
  text-align: center;

  /* keeps the heart centered in the ‚Äúletter‚Äù */
  padding-top: clamp(34px, 7vh, 110px);
}

.hh-title{
  font-family: inherit;
  font-weight: 600;
  font-size: clamp(22px, 2.4vw, 28px);
  margin: 0 0 14px;
  opacity: 0.95;
}

.hh-heart{
  position: relative;
  width: clamp(150px, 28vw, 220px);
  aspect-ratio: 1 / 1;
  margin: 16px auto 12px;
  cursor: pointer;
  touch-action: none;
  user-select: none;

  /* animation speed controlled by JS via --hhDur */
  animation: hhPulse var(--hhDur, 0.9s) ease-in-out infinite;
}

.hh-heart:active{
  transform: scale(0.99);
}

.hh-heart-svg{
  width: 100%;
  height: 100%;
  display: block;
  filter:
    drop-shadow(0 18px 34px rgba(0,0,0,0.18))
    drop-shadow(0 8px 16px rgba(0,0,0,0.10));
}

.hh-glow{
  position: absolute;
  inset: -16px;
  border-radius: 999px;
  background: radial-gradient(
    circle,
    rgba(255, 105, 180, 0.35),
    rgba(255, 105, 180, 0) 70%
  );
  filter: blur(18px);
  opacity: 0.22;
  pointer-events: none;
  animation: hhGlow var(--hhDur, 0.9s) ease-in-out infinite;
}

.hh-instruction{
  font-size: 13px;
  opacity: 0.7;
  margin: 10px 0 0;
}

.hh-message{
  max-width: 420px;
  margin: 18px auto 0;
  font-size: clamp(16px, 2vw, 20px);
  line-height: 1.35;

  opacity: 0;
  transform: translateY(8px);
  transition: opacity 500ms ease, transform 500ms ease;
}

.hh-message.is-visible{
  opacity: 1;
  transform: translateY(0);
}

@keyframes hhPulse{
  0%   { transform: scale(1); }
  18%  { transform: scale(1.055); }
  35%  { transform: scale(0.99); }
  58%  { transform: scale(1.045); }
  100% { transform: scale(1); }
}

@keyframes hhGlow{
  0%   { transform: scale(0.96); opacity: 0.16; }
  25%  { transform: scale(1.10); opacity: 0.30; }
  100% { transform: scale(0.96); opacity: 0.16; }
}
  </style>
</head>

<body>
  <div class="bg-hearts" id="bgHearts" aria-hidden="true"></div>

  <div class="wrap">
    <div class="stage">
      <div class="hint">
        Swipe <kbd>‚Üê</kbd>/<kbd>‚Üí</kbd> on mobile ‚Ä¢ click edges on desktop ‚Ä¢ arrows work too
      </div>

      <div class="book" id="book">
        <div class="book-inner">
          <div class="nav-zone nav-left" id="navLeft" title="Previous page"></div>
          <div class="nav-zone nav-right" id="navRight" title="Next page"></div>

          <div class="pages" id="pages">

            <!-- PAGE 1: Cover -->
            <section class="page" data-index="0" style="z-index:7">
              <div class="content">
                <div class="topline">
                  <span class="badge">Valentine‚Äôs Card</span>
                  <span id="pageCountA">Page 1 / 7</span>
                </div>

                <div class="cover-frame">
                  <svg class="flourish tl" viewBox="0 0 200 200" aria-hidden="true">
                    <path d="M35 120c26-8 35-28 44-48 10-23 22-44 52-52 30-8 57 6 64 32 6 23-6 49-33 58-24 8-42-2-56-18 2 20 15 38 39 45 30 9 65-8 74-40"
                          fill="none" stroke="rgba(255,77,141,.55)" stroke-width="8" stroke-linecap="round"/>
                    <path d="M58 148c18-2 31-14 40-28" fill="none" stroke="rgba(255,133,168,.45)" stroke-width="7" stroke-linecap="round"/>
                    <circle cx="118" cy="58" r="10" fill="rgba(255,77,141,.22)"/>
                    <circle cx="140" cy="44" r="6" fill="rgba(255,133,168,.18)"/>
                  </svg>

                  <svg class="flourish br" viewBox="0 0 200 200" aria-hidden="true">
                    <path d="M35 120c26-8 35-28 44-48 10-23 22-44 52-52 30-8 57 6 64 32 6 23-6 49-33 58-24 8-42-2-56-18 2 20 15 38 39 45 30 9 65-8 74-40"
                          fill="none" stroke="rgba(255,77,141,.55)" stroke-width="8" stroke-linecap="round"/>
                    <path d="M58 148c18-2 31-14 40-28" fill="none" stroke="rgba(255,133,168,.45)" stroke-width="7" stroke-linecap="round"/>
                    <circle cx="118" cy="58" r="10" fill="rgba(255,77,141,.22)"/>
                    <circle cx="140" cy="44" r="6" fill="rgba(255,133,168,.18)"/>
                  </svg>

                  <div class="cover-name engraved">Lexie</div>
                  <div class="subtitle">My Favorite Person</div>

                  <div class="seal">
                    <span class="mini-heart" aria-hidden="true"></span>
                    <span>for you, always</span>
                  </div>

                  <div class="divider" style="max-width:520px;"></div>

                  <div class="cover-tagline">
                    A little book of reasons, tiny surprises, and one very important question.
                  </div>
                </div>

                <div style="margin-top:auto; display:flex; gap:12px; align-items:center; justify-content:space-between;">
                  <div class="note" style="margin:0; opacity:.85">Tip: swipe left and right</div>
                  <div class="badge" style="background:rgba(255,255,255,.65)">‚ô•</div>
                </div>
              </div>
            </section>

            <!-- PAGE 2: Reasons -->
            <section class="page" data-index="1" style="z-index:6">
              <div class="content">
                <div class="topline">
                  <span class="badge">Chapter One</span>
                  <span>15 Reasons I Like You</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92)">
                  15 Reasons I Like You
                </h2>

                <div class="scrollable">
                  <p class="note" style="margin-top:0">Just a few‚Ä¶ but you know I could keep going.</p>
                  <div class="reasons" id="reasonsGrid"></div>

                  <div class="secrets" aria-hidden="true">
                    <div class="line">Your perfect tits</div>
                    <div class="line">Your pretty little pussy</div>
                    <div class="line">Your fat ass</div>
                    <div class="line">How you'll do anything to please me</div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PAGE 3: Scratch -->
            <section class="page" data-index="2" style="z-index:5">
              <div class="content">
                <div class="topline">
                  <span class="badge">Interactive</span>
                  <span>Scratch to Reveal</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92)">
                  Little Surprise
                </h2>

                <div class="scrollable">
                  <p class="note" style="margin-top:0">Scratch the panel to reveal the message.</p>

                  <div class="scratch-wrap">
                    <div class="panel">
                      <h3>Scratch to Reveal</h3>
                      <p>Use your finger or mouse. Scratch enough and it shows through.</p>

                      <div class="scratch-area" id="scratchArea">
                        <div class="scratch-under">You make me truly happy, Lexie.</div>
                        <canvas id="scratchCanvas"></canvas>
                      </div>

                      <div style="height:10px"></div>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PAGE 4: Compliment Jar -->
            <section class="page" data-index="3" style="z-index:4">
              <div class="content">
                <div class="topline">
                  <span class="badge">Interactive</span>
                  <span>Compliment Jar</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92); text-align:center">
                  Compliment Jar üíå
                </h2>

                <div class="jar-page">
                  <div class="mini-panel">
                    <h3>Pull a note</h3>
                    <p class="note" style="margin:0; text-align:center; max-width:none">
                      Tap the button to get a random compliment.
                    </p>

                    <button class="jar-btn" id="jarBtn" type="button">Get a compliment ‚ú®</button>

                    <div class="jar-note" id="jarNote">Tap the button üíó</div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PAGE 5: Choose the Vibe -->
            <section class="page" data-index="4" style="z-index:3">
              <div class="content">
                <div class="topline">
                  <span class="badge">Interactive</span>
                  <span>Choose the Vibe</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92); text-align:center">
                  Choose the Vibe üéß
                </h2>

                <div class="vibe-wrap">
                  <p class="note" style="margin:0 auto; text-align:center; max-width:62ch">
                    Tap one. The one you pick will get darker.
                  </p>

                  <div class="scrollable">
                    <div class="vibe-grid" id="vibeGrid"></div>
                    <div style="height:10px"></div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PAGE 6: Constellation -->
            <section class="page" data-index="5" style="z-index:2">
              <div class="content">
                <div class="topline">
                  <span class="badge">Interactive</span>
                  <span>Tap the Hearts</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92)">
                  A Little Constellation
                </h2>

                <p class="note" style="margin-top:-6px">
                  Tap the hearts to reveal something I‚Äôm looking forward to.
                </p>

                <div class="constellation" id="constellation">
                  <div class="tooltip" id="tooltip">
                    <strong>Tap a heart</strong> to reveal something I‚Äôm looking forward to.
                  </div>

                  <div class="found-counter" id="foundCounter">
                    <span class="pill" id="foundPill">0 / 6 found</span>
                  </div>
                </div>
              </div>
            </section>

            <!-- PAGE 7: Heartbeat -->
            <section class="page holdheart-page">
  <div class="hh-wrap">
    <h2 class="hh-title">Hold it.</h2>

    <div class="hh-heart" id="hhHeart" role="button" aria-label="Hold the heart">
      <svg class="hh-heart-svg" viewBox="0 0 24 24" aria-hidden="true">
        <defs>
          <linearGradient id="hhHeart3D" x1="4" y1="4" x2="20" y2="22" gradientUnits="userSpaceOnUse">
            <stop offset="0%"  stop-color="var(--pink)"/>
            <stop offset="55%" stop-color="var(--pinkDark)"/>
            <stop offset="100%" stop-color="rgba(0,0,0,0.25)"/>
          </linearGradient>

          <radialGradient id="hhHighlight" cx="35%" cy="25%" r="60%">
            <stop offset="0%" stop-color="rgba(255,255,255,0.85)"/>
            <stop offset="55%" stop-color="rgba(255,255,255,0.15)"/>
            <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
          </radialGradient>
        </defs>

        <path fill="url(#hhHeart3D)" d="M12 21s-7.2-4.7-9.7-8.6C.5 9.5 2 6.4 5.1 5.6c1.7-.4 3.5.2 4.6 1.6.4.5.7 1.1.9 1.7.2-.6.5-1.2.9-1.7 1.1-1.4 2.9-2 4.6-1.6 3.1.8 4.6 3.9 2.8 6.8C19.2 16.3 12 21 12 21z"/>
        <path fill="url(#hhHighlight)" d="M12 21s-7.2-4.7-9.7-8.6C.5 9.5 2 6.4 5.1 5.6c1.7-.4 3.5.2 4.6 1.6.4.5.7 1.1.9 1.7.2-.6.5-1.2.9-1.7 1.1-1.4 2.9-2 4.6-1.6 3.1.8 4.6 3.9 2.8 6.8C19.2 16.3 12 21 12 21z" opacity="0.75"/>
      </svg>

      <span class="hh-glow" aria-hidden="true"></span>
    </div>

    <p class="hh-instruction">Touch and hold the heart.</p>

    <p class="hh-message" id="hhMsg">This is what you do to me</p>
  </div>
</section>
            <!-- PAGE 8: FINAL -->
            <section class="page" data-index="6" style="z-index:1">
              <div class="content">
                <div class="topline">
                  <span class="badge">Final Page</span>
                  <span>One question</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:30px; color:rgba(70,25,50,.92); text-align:center">
                  Will you be my valentine?
                </h2>

                <div class="valentine-cta" id="valCta">
                  <canvas id="fireworks"></canvas>

                  <button class="yes-btn" id="yesBtn" type="button">YES!! üíñ</button>

                  <div class="yes-msg" id="yesMsg">
                    YAY!! üíó<br>
                    You just made my year
                  </div>

                  <button class="no-btn" id="noBtn" type="button">no</button>
                </div>

                <p class="note" style="text-align:center; margin-top:auto; opacity:.9; max-width:none">
                  (If ‚Äúno‚Äù runs away‚Ä¶ it‚Äôs just shy.)
                </p>
              </div>
            </section>

          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    /* Background hearts */
    (function makeBgHearts(){
      const bg = document.getElementById('bgHearts');
      const count = 18;
      for(let i=0;i<count;i++){
        const h = document.createElement('div');
        h.className = 'heart';
        const left = Math.random()*100;
        const size = 10 + Math.random()*16;
        const dur = 8 + Math.random()*10;
        const delay = Math.random()*dur;
        h.style.left = left + 'vw';
        h.style.bottom = (-10 - Math.random()*30) + 'vh';
        h.style.width = size + 'px';
        h.style.height = size + 'px';
        h.style.animationDuration = dur + 's';
        h.style.animationDelay = (-delay) + 's';
        bg.appendChild(h);
      }
    })();

    /* Page flip logic + swipe */
    const pages = Array.from(document.querySelectorAll('.page'));
    let current = 0;

    function updatePageCounters(){
      const total = pages.length;
      const el = document.getElementById('pageCountA');
      if(el) el.textContent = `Page ${current+1} / ${total}`;
    }
    function goTo(idx){
      idx = Math.max(0, Math.min(pages.length-1, idx));
      current = idx;
      pages.forEach((p,i)=> (i < current) ? p.classList.add('flipped') : p.classList.remove('flipped'));
      pages.forEach((p,i)=> p.style.zIndex = (pages.length - i));
      updatePageCounters();
    }
    function next(){ goTo(current + 1); }
    function prev(){ goTo(current - 1); }

    document.getElementById('navRight').addEventListener('click', next);
    document.getElementById('navLeft').addEventListener('click', prev);

    window.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowRight') next();
      if(e.key === 'ArrowLeft') prev();
    });

    const book = document.getElementById('book');
    let touchStartX = 0, touchStartY = 0, tracking = false;

    book.addEventListener('touchstart', (e)=>{
      if(!e.touches || e.touches.length !== 1) return;
      const t = e.touches[0];
      touchStartX = t.clientX;
      touchStartY = t.clientY;
      tracking = true;
    }, {passive:true});

    book.addEventListener('touchmove', (e)=>{
      if(!tracking || !e.touches || e.touches.length !== 1) return;
      const t = e.touches[0];
      const dx = t.clientX - touchStartX;
      const dy = t.clientY - touchStartY;
      if(Math.abs(dx) > 18 && Math.abs(dx) > Math.abs(dy) + 10) e.preventDefault();
    }, {passive:false});

    book.addEventListener('touchend', (e)=>{
      if(!tracking) return;
      tracking = false;
      const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
      if(!t) return;
      const dx = t.clientX - touchStartX;
      const dy = t.clientY - touchStartY;
      if(Math.abs(dy) > Math.abs(dx)) return;
      if(dx < -60) next();
      else if(dx > 60) prev();
    }, {passive:true});

    goTo(0);

    /* Helpers */
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }
    function randomFrom(a){ return a[Math.floor(Math.random()*a.length)] }

    /* Reasons list (random order) */
    const reasons = [
      "How easy you are to talk to",
      "Your laugh",
      "Your beautiful smile",
      "Your adorable little frown",
      "Your mesmerizing eyes",
      "The way you talk to me",
      "Your weirdness",
      "How happy you make me",
      "How sweet you are",
      "Your sense of humor",
      "Your kindness",
      "Your energy",
      "Your thoughtfulness",
      "How you make simple moments feel special",
      "The way you‚Äôre unapologetically you"
    ];
    const reasonsGrid = document.getElementById('reasonsGrid');
    reasonsGrid.innerHTML = "";
    shuffle(reasons).forEach((text, idx)=>{
      const item = document.createElement('div');
      item.className = 'reason';
      item.innerHTML = `<div class="dot">${idx+1}</div><span>${text}</span>`;
      reasonsGrid.appendChild(item);
    });

    /* Scratch (fully opaque cover) */
    const scratchArea = document.getElementById('scratchArea');
    const canvas = document.getElementById('scratchCanvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    let isDrawing = false;

    function drawScratchCover(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      ctx.setTransform(1,0,0,1,0,0);
      ctx.clearRect(0,0,canvas.width,canvas.height);

      const grad = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
      grad.addColorStop(0, 'rgba(255,77,141,1)');
      grad.addColorStop(1, 'rgba(255,133,168,1)');
      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.globalAlpha = 0.16;
      for(let i=0;i<16;i++){
        const y = (i/16)*canvas.height;
        ctx.beginPath();
        ctx.moveTo(-canvas.width*0.2, y);
        ctx.lineTo(canvas.width*1.2, y + 50*dpr);
        ctx.lineWidth = 3.2 * dpr;
        ctx.strokeStyle = 'rgba(255,255,255,0.85)';
        ctx.stroke();
      }

      ctx.globalAlpha = 0.14;
      for(let i=0;i<900;i++){
        const x = Math.random()*canvas.width;
        const y = Math.random()*canvas.height;
        const r = (Math.random()*1.2 + 0.3) * dpr;
        ctx.beginPath();
        ctx.arc(x,y,r,0,Math.PI*2);
        ctx.fillStyle = (Math.random() > 0.5) ? 'rgba(255,255,255,.75)' : 'rgba(255,255,255,.35)';
        ctx.fill();
      }
      ctx.globalAlpha = 1;
    }

    function resizeScratch(){
      const rect = scratchArea.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      canvas.width  = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      canvas.style.width = rect.width + "px";
      canvas.style.height = rect.height + "px";
      drawScratchCover();
    }

    function scratchAt(clientX, clientY){
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const x = (clientX - rect.left) * dpr;
      const y = (clientY - rect.top) * dpr;

      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath();
      ctx.arc(x, y, 24 * dpr, 0, Math.PI*2);
      ctx.fill();
      ctx.globalCompositeOperation = 'source-over';
    }

    canvas.addEventListener('pointerdown', (e)=>{
      isDrawing = true;
      canvas.setPointerCapture?.(e.pointerId);
      scratchAt(e.clientX, e.clientY);
      e.preventDefault();
    });
    canvas.addEventListener('pointermove', (e)=>{
      if(!isDrawing) return;
      scratchAt(e.clientX, e.clientY);
      e.preventDefault();
    });
    const stopScratch = ()=>{ isDrawing = false; };
    canvas.addEventListener('pointerup', stopScratch);
    canvas.addEventListener('pointercancel', stopScratch);
    window.addEventListener('resize', ()=>requestAnimationFrame(resizeScratch));
    requestAnimationFrame(resizeScratch);

    /* Compliment Jar */
    const jarNotes = [
      "I like the way you make me feel calm and excited at the same time.",
      "You‚Äôre the kind of person I‚Äôd choose in every universe.",
      "Talking to you feels like a warm hoodie.",
      "You make ordinary days feel like something worth remembering.",
      "Your energy is the best kind of contagious.",
      "You‚Äôre effortlessly lovable. (Yes, that‚Äôs a thing.)",
      "You have a way of making people feel seen.",
      "Your smile could fix a bad day in seconds.",
      "Being around you just feels‚Ä¶ right.",
      "You‚Äôre charming without even trying.",
      "You make little moments feel special.",
      "Your laugh is genuinely one of my favorite sounds.",
      "You‚Äôre the perfect mix of sweet and fun.",
      "You‚Äôre easy to be myself around.",
      "You‚Äôre thoughtful in the ways that matter most.",
      "You‚Äôre prettier than you realize.",
      "You make me look forward to things.",
      "You‚Äôre the kind of person people are lucky to know.",
      "You make the world feel softer around the edges.",
      "Your vibe is unmatched."
    ];
    const jarBtn  = document.getElementById('jarBtn');
    const jarNote = document.getElementById('jarNote');
    if(jarBtn){
      jarBtn.addEventListener('click', ()=>{
        jarNote.textContent = randomFrom(jarNotes);
        jarNote.animate([{transform:'scale(1)'},{transform:'scale(1.02)'},{transform:'scale(1)'}], {duration:220, easing:'ease-out'});
      });
    }

    /* Choose the Vibe (randomize order on load + stacked buttons) */
    const vibePairs = [
      ["Late nights üåô", "Early mornings ‚òÄÔ∏è"],
      ["Staying in üõãÔ∏è", "Going out ‚ú®"],
      ["Spontaneous üåÄ", "Planned üìÖ"],
      ["Sweet üç∞", "Salty üçø"],
      ["Soft kisses üíã", "Heavy makeouts üòÆ‚Äçüí®"],
      ["Soft music üéß", "Windows down vibes üöó"],
      ["Being silly üòÑ", "Being thoughtful üí≠"],
      ["Hair pulls üòå", "Neck kisses üíã"],
      ["Little spoon ü§ç", "Big spoon ü´∂"],
      ["Movie night üé¨", "Game night üéÆ"]
    ];
    const vibeGrid = document.getElementById('vibeGrid');
    if(vibeGrid){
      vibeGrid.innerHTML = "";
      shuffle(vibePairs).forEach((pair)=>{
        const card = document.createElement('div');
        card.className = "vibe-card";

        card.innerHTML = `
          <div class="vibe-stack">
            <button class="vibe-option" type="button">${pair[0]}</button>
            <button class="vibe-option" type="button">${pair[1]}</button>
          </div>
        `;

        const opts = Array.from(card.querySelectorAll('.vibe-option'));
        opts.forEach(btn=>{
          btn.addEventListener('click', (e)=>{
            e.preventDefault();
            e.stopPropagation();
            opts.forEach(o=>o.classList.remove('picked','dim'));
            btn.classList.add('picked');
            opts.forEach(o=>{ if(o !== btn) o.classList.add('dim'); });
          }, {passive:false});
        });

        vibeGrid.appendChild(card);
      });
    }

    /* Constellation (Things I'm looking forward to) */
    const constellation = document.getElementById('constellation');
    const tooltip = document.getElementById('tooltip');
    const foundPill = document.getElementById('foundPill');

    const memoryNotes = [
      "Getting to know you more",
      "Late-night conversations",
      "Laughing over small things",
      "Moments that don‚Äôt feel rushed",
      "That comfortable, easy feeling",
      "Seeing where this goes"
    ];
    let found = 0;

    // Keep hearts safely above tooltip/counter space
    const heartsPos = [
      {x:14, y:14},{x:38, y:10},{x:62, y:14},
      {x:22, y:34},{x:52, y:30},{x:76, y:36}
    ];
    Array.from(constellation.querySelectorAll('.spark')).forEach(n=>n.remove());
    heartsPos.forEach((pos, i)=>{
      const s = document.createElement('div');
      s.className = 'spark';
      s.style.left = `calc(${pos.x}% - 8px)`;
      s.style.top  = `calc(${pos.y}% - 8px)`;
      s.dataset.opened = "0";
      s.addEventListener('click', ()=>{
        if(s.dataset.opened === "0"){
          s.dataset.opened = "1";
          found++;
          foundPill.textContent = `${found} / 6 found`;
        }
        tooltip.innerHTML = `<strong>Looking forward to:</strong><span class="tip-text">${memoryNotes[i]}</span>`;
      });
      constellation.appendChild(s);
    });

    /* FINAL PAGE: realistic fireworks (launch -> explode -> fall), continuous after YES */
const yesBtn = document.getElementById('yesBtn');
const noBtn  = document.getElementById('noBtn');
const yesMsg = document.getElementById('yesMsg');
const fwCanvas = document.getElementById('fireworks');
const fwCtx = fwCanvas.getContext('2d');

let fireworksOn = false;
let animating = false;

let rockets = [];   // launch phase
let sparks  = [];   // explosion phase
let launchTimer = null;

function rand(min, max){ return min + Math.random() * (max - min); }

function resizeFireworks(){
  const rect = fwCanvas.getBoundingClientRect();
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  fwCanvas.width  = Math.floor(rect.width  * dpr);
  fwCanvas.height = Math.floor(rect.height * dpr);
  fwCtx.setTransform(1,0,0,1,0,0);
}
resizeFireworks();

function launchRocket(x){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  rockets.push({
    x,
    y: fwCanvas.height + 16*dpr,
    vx: rand(-0.22, 0.22) * dpr,
    vy: rand(-8.4, -7.2) * dpr,          // realistic launch speed
    ay: 0.10 * dpr,                      // gravity
    explodeY: rand(fwCanvas.height*0.18, fwCanvas.height*0.42),
    life: 240
  });
}

function explode(x, y){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  const count = Math.floor(rand(52, 78)); // enough to read as ‚Äúa firework‚Äù
  const baseHue = rand(310, 355);

  for(let i=0;i<count;i++){
    const a = Math.random() * Math.PI * 2;
    const speed = rand(2.2, 4.3) * dpr;
    sparks.push({
      x, y,
      vx: Math.cos(a)*speed,
      vy: Math.sin(a)*speed,
      ay: 0.085 * dpr,      // gravity for sparks
      drag: 0.986,          // slows outward motion
      age: 0,
      life: rand(90, 135),  // ~1.2‚Äì1.8s fall/drift
      size: rand(1.2, 2.4) * dpr,
      hue: baseHue + rand(-10, 18),
      alpha: 1
    });
  }

  if(sparks.length > 3200) sparks.splice(0, sparks.length - 3200);
}

function scheduleLaunches(){
  // cadence: explode/drift for ~1‚Äì2s, then ~0.5s later another
  // This interval is the ‚Äúpause between launches‚Äù.
  launchTimer = setInterval(()=>{
    if(!fireworksOn) return;
    resizeFireworks();

    // 1 firework usually, 2 sometimes (clearly distinct positions)
    const n = Math.random() < 0.35 ? 2 : 1;
    for(let k=0;k<n;k++){
      const x = rand(fwCanvas.width*0.15, fwCanvas.width*0.85);
      launchRocket(x);
    }

    if(!animating){
      animating = true;
      requestAnimationFrame(animateFireworks);
    }
  }, 1000); // <-- time between launches
}

function startFireworks(){
  if(fireworksOn) return;
  fireworksOn = true;

  resizeFireworks();

  // initial burst: two rockets so it‚Äôs obviously multiple fireworks
  launchRocket(fwCanvas.width * 0.33);
  launchRocket(fwCanvas.width * 0.67);

  if(!animating){
    animating = true;
    requestAnimationFrame(animateFireworks);
  }

  scheduleLaunches();
}

function animateFireworks(){
  if(!animating) return;

  // soft trail fade (lower alpha = longer trails / smoother look)
  fwCtx.globalCompositeOperation = 'source-over';
  fwCtx.fillStyle = 'rgba(255,255,255,0.10)';
  fwCtx.fillRect(0,0,fwCanvas.width, fwCanvas.height);

  // rockets
  for(let i=rockets.length-1;i>=0;i--){
    const r = rockets[i];
    r.life--;

    r.vy += r.ay;
    r.x  += r.vx;
    r.y  += r.vy;

    // draw rocket + tail
    fwCtx.beginPath();
    fwCtx.arc(r.x, r.y, 2.2, 0, Math.PI*2);
    fwCtx.fillStyle = 'rgba(255,77,141,0.90)';
    fwCtx.fill();

    fwCtx.beginPath();
    fwCtx.moveTo(r.x, r.y);
    fwCtx.lineTo(r.x - r.vx*2.2, r.y - r.vy*2.2);
    fwCtx.strokeStyle = 'rgba(255,133,168,0.55)';
    fwCtx.lineWidth = 2;
    fwCtx.stroke();

    // explode near target height or when slowing
    if(r.y <= r.explodeY || r.vy > -1.6 || r.life <= 0){
      explode(r.x, r.y);
      rockets.splice(i,1);
    }
  }

  // sparks
  fwCtx.globalCompositeOperation = 'lighter';
  for(let i=sparks.length-1;i>=0;i--){
    const p = sparks[i];
    p.age++;

    p.vx *= p.drag;
    p.vy *= p.drag;
    p.vy += p.ay;

    p.x += p.vx;
    p.y += p.vy;

    const t = 1 - (p.age / p.life);
    p.alpha = Math.max(0, t);

    fwCtx.beginPath();
    fwCtx.arc(p.x, p.y, p.size, 0, Math.PI*2);
    fwCtx.fillStyle = `hsla(${p.hue}, 95%, 72%, ${p.alpha})`;
    fwCtx.fill();

    if(p.age >= p.life) sparks.splice(i,1);
  }
  fwCtx.globalCompositeOperation = 'source-over';

  if(!fireworksOn && rockets.length === 0 && sparks.length === 0){
    animating = false;
    fwCtx.clearRect(0,0,fwCanvas.width, fwCanvas.height);
    return;
  }

  requestAnimationFrame(animateFireworks);
}

yesBtn.addEventListener('click', ()=>{
  yesMsg.style.display = 'block';
  startFireworks();
  yesBtn.animate([{transform:'scale(1)'},{transform:'scale(1.02)'},{transform:'scale(1)'}], {duration:240, easing:'ease-out'});
});
    /* NO teleports safely (never overlaps YES; always below) */
    function placeNoSafely(randomize){
      const cta = document.getElementById('valCta');
      const ctaRect = cta.getBoundingClientRect();
      const yesRect = yesBtn.getBoundingClientRect();

      const btnW = noBtn.offsetWidth || 130;
      const btnH = noBtn.offsetHeight || 40;

      const noGo = {
        left: (yesRect.left - ctaRect.left) - 18,
        right: (yesRect.right - ctaRect.left) + 18,
        top: (yesRect.top - ctaRect.top) - 18,
        bottom: (yesRect.bottom - ctaRect.top) + 18
      };

      const padL = 22, padR = 22, padB = 16;
      const minX = padL;
      const maxX = ctaRect.width - padR - btnW;

      const minY = Math.max(noGo.bottom + 24, ctaRect.height * 0.66);
      const maxY = ctaRect.height - padB - btnH;
      const safeMinY = Math.min(minY, maxY);

      let x = (ctaRect.width/2) - (btnW/2);
      let y = Math.max(safeMinY, ctaRect.height * 0.78);

      if(randomize){
        for(let tries=0; tries<50; tries++){
          x = minX + Math.random() * Math.max(8, (maxX - minX));
          y = safeMinY + Math.random() * Math.max(8, (maxY - safeMinY));

          const intersects =
            x < noGo.right &&
            x + btnW > noGo.left &&
            y < noGo.bottom &&
            y + btnH > noGo.top;

          if(!intersects) break;
        }
      }

      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";
      noBtn.style.transform = "translateX(0)";
    }

    placeNoSafely(false);

    noBtn.addEventListener('click', (e)=>{
      e.preventDefault();
      placeNoSafely(true);
      noBtn.animate(
        [{transform:'translateX(0) scale(1)'},{transform:'translateX(0) scale(1.06)'},{transform:'translateX(0) scale(1)'}],
        {duration:240, easing:'ease-out'}
      );
    });

    window.addEventListener('resize', ()=>{
      resizeFireworks();
      placeNoSafely(false);
      requestAnimationFrame(resizeScratch);
    });

/* ============================
   HOLD THE HEART (press/hold)
   ============================ */
(() => {
  const heart = document.getElementById("hhHeart");
  const msg = document.getElementById("hhMsg");
  if (!heart) return;

  let holding = false;
  let rafId = null;
  let msgTimer = null;

  // bpm -> seconds per beat
  const bpmToDur = (bpm) => (60 / bpm);

  let currentBpm = 70;   // idle
  let targetBpm  = 70;

  const setDur = (bpm) => {
    heart.style.setProperty("--hhDur", `${bpmToDur(bpm).toFixed(3)}s`);
  };

  const showMsg = () => msg && msg.classList.add("is-visible");
  const hideMsg = () => msg && msg.classList.remove("is-visible");

  const tick = () => {
    const speed = holding ? 0.12 : 0.07; // smoother ramp
    currentBpm += (targetBpm - currentBpm) * speed;

    // clamp
    currentBpm = Math.max(55, Math.min(140, currentBpm));
    setDur(currentBpm);

    rafId = requestAnimationFrame(tick);
  };

  const start = () => {
    if (rafId) return;
    setDur(currentBpm);
    rafId = requestAnimationFrame(tick);
  };

  const stopTimers = () => {
    if (msgTimer) {
      clearTimeout(msgTimer);
      msgTimer = null;
    }
  };

  const hold = () => {
    holding = true;
    targetBpm = 125;

    stopTimers();
    // show message after ~1 second of holding
    msgTimer = setTimeout(() => {
      if (holding) showMsg();
    }, 1000);

    start();
  };

  const release = () => {
    holding = false;
    targetBpm = 70;

    stopTimers();
    hideMsg();

    start();
  };

  heart.addEventListener("pointerdown", (e) => {
    e.preventDefault();
    heart.setPointerCapture?.(e.pointerId);
    hold();
  });

  heart.addEventListener("pointerup", release);
  heart.addEventListener("pointercancel", release);
  heart.addEventListener("pointerleave", () => { if (holding) release(); });

  // init
  setDur(70);
})();
  </script>
</body>
</html>
